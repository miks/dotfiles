" make Python follow PEP8 ( http://www.python.org/dev/peps/pep-0008/ )
au Bufread,BufNewFile *.as set filetype=actionscript

au FileType python set softtabstop=4 tabstop=4 shiftwidth=4 textwidth=79
au FileType php set softtabstop=4 tabstop=4 shiftwidth=4
au FileType smarty set softtabstop=4 tabstop=4 shiftwidth=4
au FileType javascript set softtabstop=4 tabstop=4 shiftwidth=4

autocmd FileType ruby,eruby let g:rubycomplete_buffer_loading = 1
autocmd FileType ruby,eruby let g:rubycomplete_classes_in_global = 1
autocmd FileType ruby,eruby let g:rubycomplete_rails = 1

au FileType actionscript set softtabstop=4 tabstop=4 shiftwidth=4 noexpandtab noendofline
set t_Co=256

" Default gui color scheme
color desert256

set guifont=Source\ Code\ Pro\ for\ Powerline:h11
set guioptions=aAce
set wrap


function! SnippetsFilename(...)
  let template = get(a:000, 0, "$1")
  let arg2 = get(a:000, 1, "")

  let basename = expand('%:t:r')

  if basename == ''
    return arg2
  else
    return substitute(template, '$1', basename, 'g')
  endif
endf

function! PromptRemoveTrainingWhitespace()
  let has_trailing_spaces=!!search('\v\s+$', 'cwn')
  if has_trailing_spaces
    if ! exists("b:remove_trailing_whitespace")
      let has_trailing_spaces=!!search('\v\s+$', 'cwn')
      if has_trailing_spaces
        let choice = confirm("Remove trailing whitespace?", "&Yes\n&No")
        if choice == 1
          call Trim()
          let b:remove_trailing_whitespace = 1
        else
          let b:remove_trailing_whitespace = 0
        endif
      endif
    elseif b:remove_trailing_whitespace == 1
      call Trim()
    endif
  endif
endfunction

function! Trim()
  let cur_linenr = line('.')
  let cur_col = col('.')
  let _s=@/
  %s/\s\+$//e
  let @/=_s
  nohl
  call cursor(cur_linenr, cur_col)
endfunction

autocmd BufWritePre * call PromptRemoveTrainingWhitespace()

:au BufWinEnter * let w:m2=matchadd('ErrorMsg', '\%>120v.\+', -1)

" ruby files settings
augroup filetype_ruby
  if has("balloon_eval")
    " Annoying plugins keep turning ballooneval on
    autocmd BufEnter *.rb setlocal noballooneval
  endif
augroup END

if has("gui_macvim")
  set transparency=7
  " Allow to select multiple lines with shift
  let macvim_hig_shift_movement = 1

  let g:solarized_menu=0
  color solarized

  " Don't beep
  set visualbell

  " Start without the toolbar
  set guioptions-=T

  let g:ctrlp_regexp = 1
  let g:RspecBin = "spring rspec"

  let g:ctrlp_abbrev = {
  \ 'gmode': 't',
  \ 'abbrevs': [
  \ {
  \ 'pattern': ' ',
  \ 'expanded': '.*',
  \ 'mode': 'pfrz',
  \ }
  \ ]
  \ }

  let g:ctrlp_custom_ignore = {
  \ 'dir':  '\v[\/](coverage|public|tmp|shared\/cache|vendor|rdoc|doc|private|_images|_build|deps|rel|_nerves-tmp)$',
  \ 'file': '\v\.(jpg|png|gif|db|DS_Store|ico)$',
  \ }

  " for ctrlp plugin to open selection in new tab
  let g:ctrlp_prompt_mappings = {
    \ 'AcceptSelection("e")': [],
    \ 'AcceptSelection("t")': ['<cr>', '<c-m>'],
    \ }

  " if file is already opened jump to it
  let g:ctrlp_jump_to_buffer = 2
endif

" disable copy on select
set go-=a

set hidden
set ignorecase
set smartcase

" Add Git info to status line
"set statusline=%<%f\ %h%m%r%{fugitive#statusline()}%=%-14.(%l,%c%V%)\ %P

" Some extra files to ignore for command-t and autocomplete
set wildignore+=log/**
set wildignore+=tmp/**
set wildignore+=vendor/**

" Sort tags by name
let Tlist_Sort_Type = "name"
let Tlist_WinWidth = 40
